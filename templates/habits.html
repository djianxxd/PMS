{{define "content"}}
<div class="max-w-7xl mx-auto">
    <!-- é¡µé¢æ ‡é¢˜å’Œç»Ÿè®¡ -->
    <div class="mb-8 animate-fade-in">
        <div class="glass-panel rounded-2xl p-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold gradient-text mb-2">ğŸ¯ ä¹ æƒ¯æ‰“å¡</h1>
                    <p class="text-gray-600">åšæŒæ¯ä¸€å¤©çš„å°ä¹ æƒ¯ï¼Œæˆå°±æ›´å¥½çš„è‡ªå·±</p>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="text-center">
                        <p class="text-sm text-gray-500">ä»Šæ—¥å®Œæˆ</p>
                        <p class="text-2xl font-bold text-green-500">{{.DoneToday}}/{{.TotalHabits}}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500">è¿ç»­å¤©æ•°</p>
                        <p class="text-2xl font-bold text-orange-500">{{.MaxStreak}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å‹‹ç« å±•ç¤º -->
    <div class="mb-8 animate-slide-up">
        <div class="glass-panel rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold gradient-text">
                    <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                    æˆå°±å‹‹ç« 
                </h2>
                <span class="text-sm text-gray-500">è§£é”è¿›åº¦ {{.UnlockedBadges}}/{{.TotalBadges}}</span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
                {{range .Badges}}
                <div class="relative group cursor-pointer">
                    <div class="flex flex-col items-center p-4 rounded-xl transition-all duration-300 {{if .Unlocked}}bg-gradient-to-br from-yellow-100 to-orange-100 hover:from-yellow-200 hover:to-orange-200{{else}}bg-gray-100 grayscale opacity-60 hover:scale-105{{end}}">
                        <div class="text-4xl mb-2 {{if not .Unlocked}}animate-pulse-soft{{end}}">{{.Icon}}</div>
                        <div class="text-xs font-medium text-center">{{.Name}}</div>
                    </div>
                    <!-- Tooltip -->
                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10">
                        <div class="font-semibold">{{.Name}}</div>
                        <div class="text-gray-300">{{.Description}}</div>
                        {{if not .Unlocked}}<div class="text-yellow-400 mt-1">ğŸ”’ æœªè§£é”</div>{{end}}
                    </div>
                </div>
                {{end}}
            </div>
            <div class="text-center py-8 text-gray-400">
                <i class="fas fa-history text-4xl mb-3 block"></i>
                <p class="text-lg font-medium mb-2">æ›´å¤šå‹‹ç« é€šè¿‡ä¹ æƒ¯æ‰“å¡è·å¾—</p>
            </div>
        </div>
    </div>

    <!-- ä¹ æƒ¯ç®¡ç†åŒºåŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- æ–°å»ºä¹ æƒ¯æŒ‰é’® -->
        <div class="lg:col-span-3 animate-slide-up">
            <div class="glass-panel rounded-2xl p-6 border-2 border-dashed border-gray-300 hover:border-blue-400 transition-colors cursor-pointer group" onclick="document.getElementById('addHabitModal').classList.remove('hidden')">
                <div class="flex items-center justify-center py-8">
                    <div class="flex items-center text-gray-400 group-hover:text-blue-500 transition-colors">
                        <i class="fas fa-plus-circle text-3xl mr-3"></i>
                        <span class="text-lg font-medium">æ·»åŠ æ–°ä¹ æƒ¯</span>
                    </div>
                </div>
            </div>

        <!-- ä¹ æƒ¯å¡ç‰‡ -->
        {{range $index, $habit := .Habits}}
        <div class="animate-bounce-in" style="animation-delay: {{mul $index 0.2}}s;">
            <div class="glass-panel rounded-2xl p-6 hover:shadow-card-hover transition-all duration-300 relative group">
                <!-- ä¹ æƒ¯ä¿¡æ¯ -->
                <div class="mb-6">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-1">{{.Name}}</h3>
                            <p class="text-sm text-gray-600">{{.Description}}</p>
                        </div>
                    </div>
                </div>

                <!-- è¿›åº¦æ¡ -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600">æœ¬æœˆè¿›åº¦</span>
                        <span class="text-sm font-semibold text-blue-600">70%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-blue-400 to-blue-600 h-3 rounded-full transition-all duration-500" style="width: 70%"></div>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-calendar-alt mr-1"></i>
                        {{if .TodayChecked}}
                            <span class="text-green-500 font-semibold">âœ“ ä»Šæ—¥å·²æ‰“å¡</span>
                        {{else}}
                            <span>ä»Šæ—¥æœªæ‰“å¡</span>
                        {{end}}
                    </div>
                    <div class="flex items-center space-x-2">
                        <form action="/habits/checkin" method="POST" class="inline">
                            <input type="hidden" name="habit_id" value="{{.ID}}">
                            <button type="submit" 
                                    {{if .TodayChecked}}disabled{{end}}
                                    class="px-4 py-2 rounded-lg font-medium transition-all duration-300 {{if .TodayChecked}}bg-gray-200 text-gray-400 cursor-not-allowed{{else}}bg-gradient-to-r from-green-400 to-emerald-500 text-white hover:from-green-500 hover:to-emerald-600 transform hover:scale-105{{end}}">
                                {{if .TodayChecked}}
                                    <i class="fas fa-check mr-2"></i>å·²å®Œæˆ
                                {{else}}
                                    <i class="fas fa-check-circle mr-2"></i>æ‰“å¡
                                {{end}}
                            </button>
                        </form>
                    </div>

                    <!-- åˆ é™¤æŒ‰é’® -->
                    <form action="/habits/delete" method="POST" 
                          onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¹ æƒ¯å—ï¼Ÿè¿™å°†åŒæ—¶åˆ é™¤æ‰€æœ‰æ‰“å¡è®°å½•ã€‚');" 
                          class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                        <input type="hidden" name="id" value="{{.ID}}">
                        <button type="submit" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                </div>
            </div>
        {{end}}
    </div>

    <!-- æ‰“å¡æ—¥å†è§†å›¾ -->
    <div class="glass-panel rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.4s;">
        <h2 class="text-xl font-bold text-gray-800 mb-6">
            <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
            æ‰“å¡æ—¥å†
        </h2>
        <div id="calendar" class="grid grid-cols-7 gap-2">
            <!-- æ—¥å†å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<!-- æ·»åŠ ä¹ æƒ¯å¼¹çª— -->
<div id="addHabitModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="glass-panel rounded-2xl p-8 max-w-md w-full animate-bounce-in">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-gray-800">
                <i class="fas fa-plus-circle text-green-500 mr-2"></i>
                åˆ›å»ºæ–°ä¹ æƒ¯
            </h3>
            <button onclick="document.getElementById('addHabitModal').classList.add('hidden')" 
                    class="text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <form action="/habits/add" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ä¹ æƒ¯åç§°</label>
                <input type="text" name="name" required 
                       class="input-field w-full px-4 py-3 rounded-xl"
                       placeholder="ä¾‹å¦‚ï¼šæ¯æ—¥é˜…è¯»ã€è¿åŠ¨å¥èº«...">
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">æè¿°</label>
                <textarea name="description" rows="3" 
                          class="input-field w-full px-4 py-3 rounded-xl resize-none"
                          placeholder="æè¿°è¿™ä¸ªä¹ æƒ¯çš„ç›®æ ‡..."></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">é¢‘ç‡</label>
                <select name="frequency" class="input-field w-full px-4 py-3 rounded-xl appearance-none cursor-pointer bg-white">
                    <option value="daily">æ¯æ—¥</option>
                    <option value="weekly">æ¯å‘¨</option>
                </select>
            </div>

            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="document.getElementById('addHabitModal').classList.add('hidden')" 
                        class="px-6 py-3 text-gray-600 hover:text-gray-800 transition-colors">
                    å–æ¶ˆ
                </button>
                <button type="submit" class="btn-primary px-6 py-3 rounded-xl text-white font-semibold">
                    <i class="fas fa-plus mr-2"></i>
                    åˆ›å»ºä¹ æƒ¯
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // ç”Ÿæˆæ—¥å†
    function generateCalendar() {
        const calendar = document.getElementById('calendar');
        if (!calendar) return;

        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        // æ˜ŸæœŸæ ‡é¢˜
        const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        let html = '';
        
        weekDays.forEach(day => {
            html += '<div class="text-center text-xs font-semibold text-gray-600 p-2">' + day + '</div>';
        });

        // ç©ºç™½æ—¥æœŸ
        for (let i = 0; i < firstDay; i++) {
            html += '<div></div>';
        }

        // æ—¥æœŸ
        for (let day = 1; day <= daysInMonth; day++) {
            const isToday = day === today.getDate();
            const isWeekend = (firstDay + day - 1) % 7 === 0 || (firstDay + day - 1) % 7 === 6;
            
            let dayClass = 'p-2 text-center rounded-lg cursor-pointer transition-all duration-200 ';
            if (isToday) {
                dayClass += 'bg-gradient-to-r from-blue-400 to-blue-600 text-white font-bold ';
            } else if (isWeekend) {
                dayClass += 'bg-gray-100 text-gray-600 ';
            } else {
                dayClass += 'hover:bg-gray-100 ';
            }

            // æ¨¡æ‹Ÿæ‰“å¡çŠ¶æ€
            const hasChecked = Math.random() > 0.3;
            if (hasChecked && !isToday) {
                dayClass += 'bg-green-100 text-green-700 ';
            }

            html += '<div class="' + dayClass + '">' +
                day +
                (hasChecked ? '<div class="text-xs">âœ“</div>' : '') +
            '</div>';
        }

        calendar.innerHTML = html;
    }

    // æ·»åŠ  ESC é”®å…³é—­å¼¹çª—
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            document.getElementById('addHabitModal').classList.add('hidden');
        }
    });

    // ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—
    const modal = document.getElementById('addHabitModal');
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
    });

    // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆæ—¥å†
    document.addEventListener('DOMContentLoaded', function() {
        generateCalendar();
    });
</script>
{{end}}